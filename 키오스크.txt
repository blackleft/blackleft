import datetime
import time
import random

def deco(fn):
    def reciept(self):
        print('âŸ' + '-' * 30 + 'âŸ')
        for i in range(3):
            print('|' + ' ' * 31 + '|')
        fn(self)
        print('='*33)
        print("Thank You".center(32))
        for i in range(3):
            print('|' + ' ' * 31 + '|')
        print('âŸ' + '-' * 30 + 'âŸ')
    return reciept


class Kiosk:
    def __init__(self):
        self.menu = [
            {'name':'americano','price': 2000,"count":1},
            {'name':'latte','price': 3000,"count":2},
            {'name':'mocha','price': 3000,"count":3},
            {'name':'yuza_tea','price': 2500,"count":1},
            {'name':'green_tea','price': 2500,"count":1},
            {'name':'choco_latte','price': 3000,"count":0}
        ]
        self.order_menu = []
        self.order_price = []
        self.order_items = []   # âœ… ë©”ë‰´ ì´ë¦„ ì €ì¥ ë¦¬ìŠ¤íŠ¸ (ìˆ˜ëŸ‰ ë³µì›ìš©)
        self.macaron_coupon = False  

    # ì¸íŠ¸ë¡œ ë©”ì„œë“œ
    def greeting(self):
        # âœ… UTC ê¸°ì¤€ +9ì‹œê°„ìœ¼ë¡œ í•œêµ­ ì‹œê°„ ë§ì¶¤
        now = datetime.datetime.utcnow() + datetime.timedelta(hours=9)
        hour = now.hour

        if 5 <= hour < 12:
            greeting = "â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤! í–¥ê¸‹í•œ ì»¤í”¼ í•œ ì” ì–´ë– ì„¸ìš”?"
        elif 12 <= hour < 18:
            greeting = "ğŸŒ¼ ì•ˆë…•í•˜ì„¸ìš”! ì˜¤í›„ì˜ ì—¬ìœ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”."
        elif 18 <= hour < 22:
            greeting = "ğŸŒ™ ë°˜ê°‘ìŠµë‹ˆë‹¤! ì €ë…ì—ë„ ë”°ëœ»í•œ í•œ ì” ì–´ë•Œìš”?"
        else:
            greeting = "ğŸŒƒ ëŠ¦ì€ ì‹œê°„ì—ë„ ì°¾ì•„ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤."

        print(greeting.center(70, '='))

    # ë©”ë‰´ ì¶œë ¥
    def menu_print(self):
        for i, item in enumerate(self.menu):
            if item['count'] == 0:
                print(i + 1, item['name'], ' : Sold Out')
            else:
                print(i + 1, item['name'], ' : ', item['price'], 'ì›')

    # ì£¼ë¬¸
    def menu_select(self):
        while True:
            try:
                n = int(input("\nìŒë£Œì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”: "))
            except ValueError:
                print("ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
                continue
            if not (1 <= n <= len(self.menu)):
                print("ì—†ëŠ” ë©”ë‰´ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì£¼ë¬¸í•´ ì£¼ì„¸ìš”.")
                continue
            if self.menu[n-1]['count'] <= 0:
                print('ì¬ë£Œê°€ ëª¨ë‘ ì†Œì§„ëœ ë©”ë‰´ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì£¼ë¬¸í•´ ì£¼ì„¸ìš”.')
                continue
        
            item = self.menu[n-1]
            self.menu_selected = item['name']
            self.price_selected = item['price']
            item['count'] -= 1
            break
            
        # ì˜¨ë„
        while True:
            try:
                t = int(input('HOT ìŒë£ŒëŠ” 1ì„, ICE ìŒë£ŒëŠ” 2ë¥¼ ì…ë ¥í•˜ì„¸ìš”: '))
                if t == 1:
                    self.temp = "ğŸ”¥HOT"
                    self.receipt_temp = "HOT"
                    break
                elif t == 2:
                    self.temp = "ğŸ§ŠICE"
                    self.receipt_temp = "ICE"
                    break
                else:
                    print("1ê³¼ 2 ì¤‘ í•˜ë‚˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
            except ValueError:
                print("ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")

        # âœ… ë‹¹ë„ ì„ íƒ ì œê±° ì™„ë£Œ

        # ì»µ ì¢…ë¥˜
        while True:
            mug = input("ë¨¸ê·¸ì»µ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ").lower()
            if mug in ('y', 'yes'):
                self.mug = "ë¨¸ê·¸ì»µâ˜•"
                self.receipt_mug = "ë¨¸ê·¸ì»µ"
                break
            elif mug in ('n', 'no'):
                self.mug = "ì¼íšŒìš©ì»µğŸ¥¤"
                self.receipt_mug = "ì¼íšŒìš©ì»µ"
                break
            else:
                print("y ë˜ëŠ” nìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.")

        # ì‚¬ì´ì¦ˆ
        while True:
            size = input("ì‚¬ì´ì¦ˆë¥¼ ì„ íƒí•˜ì„¸ìš” (S / M / L): ").upper()
            if size in ('S', 'M', 'L'):
                self.size = size
                if size == 'M':
                    self.price_selected += 500
                elif size == 'L':
                    self.price_selected += 1000
                break
            else:
                print("S, M, L ì¤‘ì—ì„œ ì„ íƒí•´ì£¼ì„¸ìš”.")

        display_name = f"{self.temp} {self.size} {self.menu_selected} ({self.mug})"
        receipt_name = f"{self.receipt_temp} {self.size} {self.menu_selected}"

        self.order_menu.append(display_name)
        self.order_price.append(self.price_selected)
        self.order_items.append(self.menu_selected)  # âœ… ë©”ë‰´ ì´ë¦„ ì €ì¥
        self.receipt_menu = getattr(self, "receipt_menu", [])
        self.receipt_menu.append(receipt_name)

        print(f"\nâœ… ì£¼ë¬¸ ìŒë£Œ: {display_name}  :  {self.price_selected} ì›")
        print('ğŸ’° ì£¼ë¬¸ í•©ê³„ :', sum(self.order_price), 'ì›')

    def ask_order(self):
        while True:
            n = int(input('\nì£¼ë¬¸ ì™„ë£Œ : 0\nì¶”ê°€ ì£¼ë¬¸ : 1\nì¼ë¶€ ì·¨ì†Œ : 2\nì „ë¶€ ì·¨ì†Œ : 3\nì…ë ¥ : '))
            if n == 0:
                break
            elif n == 1:
                print()
                self.add_order()
            elif n == 2:
                self.cancel_order()
            elif n == 3:
                self.cancel_all()
                print('\nì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.\n')
                self.greeting()
                self.menu_print()
                self.menu_select()
                self.ask_order()
                return
            else:
                n = int(input('ì…ë ¥ ì˜¤ë¥˜, ë‹¤ì‹œ ê³¨ë¼ì£¼ì„¸ìš”: '))
        self.pay()

    def add_order(self):
        self.menu_print() 
        self.menu_select()
        
    def cancel_order(self):
        print()
        for i, order in enumerate(zip(self.order_menu,self.order_price)):
            print(i+1, order[0], ':', order[1], 'ì›')
        n = int(input('ì·¨ì†Œí•˜ê³  ì‹¶ì€ ì£¼ë¬¸ ë²ˆí˜¸ë¥¼ í•˜ë‚˜ ì„ íƒí•˜ì„¸ìš”: '))
        
        canceled_menu = self.order_menu.pop(n-1)
        canceled_item = self.order_items.pop(n-1)
        self.order_price.pop(n-1)

        for i in self.menu:
            if i['name'] == canceled_item:
                i['count'] += 1
                break

        print(canceled_menu+'ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')
        print('ì£¼ë¬¸ ëª©ë¡ :', [x for x in self.order_menu])

        # âœ… ì£¼ë¬¸ì´ ì „ë¶€ ì·¨ì†Œëœ ê²½ìš° ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ë³µê·€
        if not self.order_menu:
            print("\nëª¨ë“  ì£¼ë¬¸ì´ ì·¨ì†Œë˜ì–´ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.\n")
            self.greeting()
            self.menu_print()
            self.menu_select()
            self.ask_order()
            return

    def cancel_all(self):
        for item_name in self.order_items:
            for j in self.menu:
                if j['name'] == item_name:
                    j['count'] += 1
                    break
        self.order_menu.clear()
        self.order_price.clear()
        self.order_items.clear()

    def event_quiz(self):
        n = input("ì´ë²¤íŠ¸ì— ì°¸ì—¬í•´ì£¼ì„¸ìš”!\ní€´ì¦ˆë¥¼ ë§ì¶”ë©´ ë‹¬ì½¤í•œ ë¯¸ë‹ˆ ë§ˆì¹´ë¡±ğŸ¬ì„ ë“œë¦½ë‹ˆë‹¤!\nì´ë²¤íŠ¸ ì°¸ì—¬(1), ë°”ë¡œ ê²°ì œ(0): ")

        try:
            n = int(n)
        except ValueError:
            print("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.\n")
            return self.event_quiz()

        if n == 1:
            print("\nğŸ‰ í€´ì¦ˆì— ì°¸ì—¬í•˜ì…¨ìŠµë‹ˆë‹¤!\n")
            print("ê°ì²´ê°€ ìƒì„±ë  ë•Œ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?\n")
            print("ì•„ë˜ ë³´ê¸° ì¤‘ ì•Œë§ì€ ë‹µì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\n")

            answers = ["init()", "call()", "main()", "start()"]
            for i, ans in enumerate(answers, start=1):
                print(f"{i}. {ans}")

            answer = input("\nì •ë‹µ ë²ˆí˜¸ ì…ë ¥: ")

            if answer == "1":
                print("\në©‹ì§„ ê·¸ë£¨ë‹˜, ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰")
                print("\nğŸ’¡ í•´ì„¤:")
                print("`__init__()`ì€ **ìƒì„±ì(Constructor)**ì…ë‹ˆë‹¤.")
                print("ê°ì²´ê°€ ìƒì„±ë  ë•Œ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ì–´, ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.\n")
                print("[ë‹¬ì½¤í•œ ë¯¸ë‹ˆ ë§ˆì¹´ë¡±ğŸ¬] ì¿ í°ì„ ë°œê¸‰í•´ë“œë¦´ê²Œìš”!\n")
                self.macaron_coupon = True
            else:
                print("\nì•„ì‰½ì§€ë§Œ ë‹¤ë¥¸ ë‹µì„ ê³ ë¥´ì…¨ë„¤ìš” ğŸ˜¢ ë‹¤ìŒ ê¸°íšŒì— ë§Œë‚˜ìš”!\n")
                self.macaron_coupon = False

        elif n == 0:
            print("\nì´ë²¤íŠ¸ë¥¼ ê±´ë„ˆë›°ê³  ë°”ë¡œ ê²°ì œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.\n")
        else:
            print("ì˜ëª»ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.\n")
            return self.event_quiz()

    def pay(self):
        print('\n' + '=' * 33 + '\në©”ë‰´ ì„ íƒ ì™„ë£Œ\n' + '=' * 33)
        self.event_quiz()
        n = input("\nê²°ì œ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\ní˜„ê¸ˆ('cash' or 1) ì¹´ë“œ('card' or 2): ")
        while n not in ('í˜„ê¸ˆ', 'cash', '1', 'ì¹´ë“œ', 'card', '2'):
            n = input('\në‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”: ')
        if n in ('í˜„ê¸ˆ', 'cash', '1'):
            print('\nì§ì›ì„ í˜¸ì¶œí•˜ê² ìŠµë‹ˆë‹¤.')
            time.sleep(2)
            print('ğŸ’µ í˜„ê¸ˆ ê²°ì œ ì¤‘...')
            self.payment_method = 'í˜„ê¸ˆ'
            self.cash_recieved = random.randint(sum(self.order_price), sum(self.order_price) + 30000)
            time.sleep(2)
            return self.table()
        elif n in ('ì¹´ë“œ', 'card', '2'):
            print('\nICì¹© ë°©í–¥ì— ë§ê²Œ ì¹´ë“œë¥¼ ê½‚ì•„ì£¼ì„¸ìš”.')
            time.sleep(1)
            print('ğŸ’³ ì¹´ë“œ ì½ëŠ” ì¤‘...')
            self.payment_method = 'ì¹´ë“œ'
            self.card_num = '****-****-****-' + str(random.randint(0, 9999)).zfill(4)
            time.sleep(2)
            return self.table()

    @deco
    def table(self):
        print('ì£¼ë¬¸ ì¼ì‹œ : ' + (datetime.datetime.utcnow() + datetime.timedelta(hours=9)).strftime("%Y-%m-%d %H:%M:%S"))
        print('=' * 33)
        for i in range(len(self.receipt_menu)):
            print(self.receipt_menu[i], ' : ', self.order_price[i])
        print('=' * 33)
        print('í•©ê³„ ê¸ˆì•¡ :', sum(self.order_price))
        print('ê²°ì œ ìˆ˜ë‹¨ :', self.payment_method)
        if self.payment_method == 'ì¹´ë“œ':
            print('ì¹´ë“œ ë²ˆí˜¸ :', self.card_num)
        elif self.payment_method == 'í˜„ê¸ˆ':
            print('ë°›ì€ ëˆ :', self.cash_recieved)
            print('ê±°ìŠ¤ë¦„ ëˆ :', self.cash_recieved - sum(self.order_price))

        if hasattr(self, 'macaron_coupon') and self.macaron_coupon:
            print("[ë¯¸ë‹ˆ ë§ˆì¹´ë¡± ì¿ í°]".center(27, '*'))


if __name__ == "__main__":
    kiosk = Kiosk()
    kiosk.greeting()
    kiosk.menu_print()
    kiosk.menu_select()
    kiosk.ask_order()
